---
# Shared Configuration - Values used by multiple services
# This ConfigMap contains infrastructure endpoints and platform-wide settings
apiVersion: v1
kind: ConfigMap
metadata:
  name: shared-config
  namespace: saasodoo
  labels:
    app.kubernetes.io/component: platform
    app.kubernetes.io/managed-by: platform-team
data:
  # Platform Domain
  BASE_DOMAIN: "109.199.108.243.nip.io"
  FRONTEND_URL: "http://app.109.199.108.243.nip.io"

  # CORS Configuration (app.* for dashboard, www.* for marketing site)
  CORS_ALLOWED_ORIGINS: "http://app.109.199.108.243.nip.io,https://app.109.199.108.243.nip.io,http://www.109.199.108.243.nip.io,https://www.109.199.108.243.nip.io"
  CORS_ALLOW_CREDENTIALS: "true"
  CORS_ALLOWED_METHODS: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
  CORS_ALLOWED_HEADERS: "Authorization,Content-Type,X-Requested-With,Accept,Origin"

  # PostgreSQL Infrastructure (CloudNativePG with PgBouncer)
  # Using PgBouncer pooler for efficient connection management
  POSTGRES_HOST: "postgres-cluster-pooler-rw.saasodoo.svc.cluster.local"
  POSTGRES_PORT: "5432"
  POSTGRES_DEFAULT_DB: "postgres"

  # Redis Infrastructure (Redis Operator Cluster with Sentinel - No Auth)
  # Applications connect via Sentinel for automatic failover discovery
  REDIS_SENTINEL_ENABLED: "true"
  REDIS_SENTINEL_HOST: "rfs-redis-cluster.saasodoo.svc.cluster.local"
  REDIS_SENTINEL_PORT: "26379"
  REDIS_SENTINEL_MASTER: "mymaster"
  REDIS_DB: "0"
  # REDIS_PASSWORD not set - Redis cluster has no authentication

  # Fallback direct connection (not used when Sentinel enabled)
  REDIS_HOST: "redis-master.saasodoo.svc.cluster.local"
  REDIS_PORT: "6379"

  # RabbitMQ Infrastructure
  RABBITMQ_HOST: "rabbitmq.saasodoo.svc.cluster.local"
  RABBITMQ_PORT: "5672"
  RABBITMQ_VHOST: "saasodoo"
  RABBITMQ_USER: "saasodoo"

  # Kubernetes Platform
  ORCHESTRATOR: "Kubernetes"
  KUBERNETES_NAMESPACE: "saasodoo"
  KUBERNETES_IN_CLUSTER: "true"

  # Environment Settings
  ENVIRONMENT: "production"
  TIMEZONE: "Africa/Harare"
  FLASK_ENV: "production"
  FLASK_DEBUG: "0"

  # KillBill Configuration (non-sensitive only)
  KILLBILL_URL: "http://killbill.saasodoo.svc.cluster.local:8080"
  KILLBILL_USERNAME: "admin"

  # CephFS Storage
  CEPHFS_MOUNT_PATH: "/mnt/cephfs"

  # Inter-Service URLs
  NOTIFICATION_SERVICE_URL: "http://notification-service.saasodoo.svc.cluster.local:5000"

  # Celery Common Settings
  C_FORCE_ROOT: "true"
  CELERY_POOL: "threads"
